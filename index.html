<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPTM SOVEREIGN // SOLO EDITION</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">

    <style>
        /* --- THEME: DEEP SEA & SIGNAL YELLOW --- */
        :root {
            --bg-body: #020b16;
            --bg-panel: #051e3e;
            --border: #1e3a5f;
            
            --accent-yellow: #ffd700; 
            --accent-green: #10b981;
            --accent-amber: #f59e0b;
            
            /* VECTOR COLORS */
            --col-2023: #94a3b8; /* Titanium Grey */
            --col-2024: #a855f7; /* Deep Purple */
            --col-2025: #3b82f6; /* Core Blue */
            --col-2026: #f97316; /* Blaze Orange */
            
            --font-mono: "JetBrains Mono", monospace;
            --font-ui: "Inter", sans-serif;
        }

        body.god-mode { --border: var(--accent-yellow); }
        body.god-mode .sidebar { border-right: 1px solid var(--accent-yellow); }

        /* 全局禁止选中 (防下载/复制) */
        * { box-sizing: border-box; outline: none; user-select: none; -webkit-user-select: none; }
        
        body { margin: 0; padding: 0; font-family: var(--font-ui); background: var(--bg-body); color: #ccc; overflow: hidden; height: 100vh; width: 100vw; cursor: default; }
        
        #app { display: flex; flex-direction: column; height: 100%; filter: blur(10px); transition: 0.8s; pointer-events: none; }
        #app.unlocked { filter: blur(0); pointer-events: all; }

        /* --- 1. LOGIN: STAR SEA ANIMATION --- */
        #loginOverlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; 
            display: flex; justify-content: center; align-items: center; flex-direction: column;
            background: radial-gradient(circle at center, #0f2e52 0%, #020b16 100%);
            overflow: hidden;
        }
        
        .star-container { position: absolute; width: 100%; height: 100%; overflow: hidden; pointer-events: none; }
        .star {
            position: absolute; background: #fff; border-radius: 50%;
            animation: floatUp linear infinite; opacity: 0;
        }
        @keyframes floatUp {
            0% { transform: translateY(100vh) scale(0); opacity: 0; }
            50% { opacity: 0.8; }
            100% { transform: translateY(-10vh) scale(1.5); opacity: 0; }
        }

        .login-box { 
            width: 400px; padding: 40px; border: 1px solid rgba(255,215,0,0.3); 
            background: rgba(5, 30, 62, 0.8); backdrop-filter: blur(20px);
            box-shadow: 0 0 100px rgba(0,0,0,0.6); border-radius: 12px; z-index: 2;
        }
        .login-title { font-size: 20px; font-weight: 900; color: #fff; margin-bottom: 30px; letter-spacing: 4px; text-align: center; }
        .login-input { 
            width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border); color: #fff; 
            padding: 12px; font-family: var(--font-mono); font-size: 12px; margin-bottom: 15px; border-radius: 4px; 
            user-select: text; /* Allow typing */ cursor: text;
        }
        .login-input:focus { border-color: var(--accent-yellow); background: rgba(0,0,0,0.5); }
        .enter-btn { width: 100%; background: var(--accent-yellow); color: #000; border: none; padding: 12px; font-weight: 800; cursor: pointer; margin-top: 10px; border-radius: 4px; letter-spacing: 1px; transition: 0.2s; }
        .enter-btn:hover { background: #fff; box-shadow: 0 0 20px rgba(255,215,0,0.4); }
        .reg-link { 
            text-align: center; margin-top: 15px; font-size: 11px; color: var(--accent-data); 
            text-decoration: underline; cursor: pointer; opacity: 0.7; transition: 0.2s;
        }
        .reg-link:hover { opacity: 1; color: #fff; }

        /* --- HEADER --- */
        header { height: 50px; background: #0a1018; border-bottom: 1px solid var(--border); display: grid; grid-template-columns: 250px 1fr 300px; align-items: center; padding: 0 20px; z-index: 500; }
        .brand { font-size: 16px; font-weight: 900; color: #fff; letter-spacing: 2px; display: flex; align-items: center; gap: 10px; }
        .brand span { color: var(--accent-yellow); }

        .ai-topbar { display: flex; align-items: center; justify-content: center; gap: 15px; font-family: var(--font-mono); font-size: 11px; color: #888; cursor: pointer; height: 100%; }
        .ai-status { display: flex; align-items: center; gap: 6px; }
        .ai-dot { width: 6px; height: 6px; border-radius: 50%; }
        .ai-msg-preview { max-width: 400px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #ccc; }
        
        .header-controls { display: flex; justify-content: flex-end; align-items: center; gap: 10px; }
        .view-switch { display: none; background: #000; border: 1px solid var(--border); border-radius: 4px; padding: 2px; }
        .vs-btn { padding: 6px 12px; font-size: 10px; border: none; background: transparent; color: #666; cursor: pointer; font-weight: 700; font-family: var(--font-mono); border-radius: 2px; }
        .vs-btn.active { background: var(--accent-yellow); color: #000; }
        .user-badge { font-family: var(--font-mono); font-size: 11px; padding: 5px 10px; border: 1px solid var(--border); border-radius: 4px; color: #888; }

        /* --- AI DROPDOWN --- */
        #aiDropdown { position: absolute; top: 50px; left: 50%; transform: translateX(-50%); width: 500px; background: rgba(5, 30, 62, 0.98); border: 1px solid var(--border); border-top: none; box-shadow: 0 10px 40px rgba(0,0,0,0.5); display: none; flex-direction: column; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; overflow: hidden; }
        .ai-body { height: 250px; overflow-y: auto; padding: 15px; font-family: var(--font-mono); font-size: 11px; }
        .chat-row { display: flex; gap: 10px; margin-bottom: 8px; align-items: flex-start; }
        .avatar { width: 24px; height: 24px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
        .avatar.concierge { border: 1px solid var(--accent-green); color: var(--accent-green); background: rgba(16, 185, 129, 0.1); }
        .avatar.engineer { border: 1px solid var(--accent-amber); color: var(--accent-amber); background: rgba(245, 158, 11, 0.1); }
        .bubble { background: rgba(0,0,0,0.3); padding: 8px 12px; border-radius: 4px; color: #ddd; line-height: 1.4; border: 1px solid rgba(255,255,255,0.05); }

        /* --- WORKSPACE --- */
        #workspace { flex: 1; display: grid; grid-template-columns: 340px 1fr; overflow: hidden; }
        .sidebar { background: var(--bg-panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        .p-head { padding: 15px; border-bottom: 1px solid var(--border); font-size: 11px; font-weight: 700; color: #fff; letter-spacing: 1px; background: rgba(0,0,0,0.2); }
        .p-body { flex: 1; overflow-y: auto; padding: 20px; }

        /* MODULES */
        .module { margin-bottom: 25px; border-bottom: 1px dashed var(--border); padding-bottom: 20px; }
        .mod-title { font-size: 10px; color: var(--accent-yellow); font-weight: 700; margin-bottom: 10px; }
        .aoi-box { border: 1px solid #222; padding: 10px; background: #0a0a0a; margin-bottom: 10px; border-radius: 4px; }
        .sys-select { width: 100%; background: #151515; border: 1px solid #333; color: #ccc; padding: 8px; font-family: var(--font-mono); font-size: 11px; outline: none; }
        .upload-zone { border: 1px dashed #444; padding: 20px; text-align: center; cursor: pointer; transition: 0.2s; border-radius: 4px; }
        .upload-zone:hover { border-color: var(--accent-data); color: var(--accent-data); }

        .sample-btn { width: 100%; background: linear-gradient(90deg, rgba(255,215,0,0.1), transparent); border: 1px solid var(--accent-yellow); color: var(--accent-yellow); padding: 15px; margin-bottom: 20px; cursor: pointer; text-align: left; display: flex; align-items: center; gap: 10px; border-radius: 4px; transition: 0.2s; }
        .sample-btn:hover { background: var(--accent-yellow); color: #000; font-weight: 800; }

        .year-toggle { display: flex; justify-content: space-between; align-items: center; background: #111; border: 1px solid #222; padding: 10px; margin-bottom: 5px; cursor: pointer; opacity: 1; transition: 0.3s; border-radius: 4px; }
        .year-toggle.disabled { opacity: 0.4; cursor: not-allowed; border-style: dashed; filter: grayscale(1); }
        .year-toggle.active { border-color: #fff; background: #1a1a1a; }
        .year-tag { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 8px; }

        /* ADMIN */
        #sidebar-admin { display: none; }
        .admin-upload-card { background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 15px; margin-bottom: 10px; border-radius: 4px; }
        .auc-header { display: flex; justify-content: space-between; margin-bottom: 10px; color: #fff; font-weight: 700; font-size: 12px; }
        .auc-status { font-size: 9px; padding: 2px 6px; background: #000; color: #666; border-radius: 2px; font-family: var(--font-mono); }
        .auc-status.live { color: var(--accent-green); border: 1px solid var(--accent-green); }
        .upload-btn-mini { width: 100%; border: 1px dashed #666; color: #888; padding: 8px; text-align: center; font-size: 10px; cursor: pointer; border-radius: 2px; }
        .upload-btn-mini:hover { border-color: var(--accent-yellow); color: var(--accent-yellow); }

        /* --- OMNI-MODAL (WORKFLOW) --- */
        #workflowModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(2, 11, 22, 0.95); z-index: 2000; display: none; justify-content: center; align-items: center; }
        .wf-box { width: 650px; height: 600px; background: var(--bg-panel); border: 1px solid var(--accent-yellow); border-radius: 8px; display: flex; flex-direction: column; position: relative; box-shadow: 0 0 80px rgba(0,0,0,0.8); }
        .wf-header { padding: 15px 25px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); }
        .wf-title { font-weight: 900; color: #fff; letter-spacing: 1px; font-size: 14px; }
        .wf-close { cursor: pointer; font-size: 24px; color: #666; transition: 0.2s; line-height: 1; }
        .wf-close:hover { color: #fff; }
        
        .wf-body { flex: 1; padding: 30px; overflow-y: auto; color: #ccc; font-size: 13px; line-height: 1.6; }
        
        .wf-footer { padding: 15px 25px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); }
        .nav-btn { padding: 8px 20px; border: 1px solid #666; background: transparent; color: #ccc; cursor: pointer; border-radius: 4px; font-weight: 700; font-size: 11px; }
        .nav-btn:hover { border-color: #fff; color: #fff; }
        .nav-btn.primary { background: var(--accent-yellow); color: #000; border: none; }
        .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        /* NDA Specifics */
        .nda-text { background: rgba(255,255,255,0.05); padding: 15px; height: 250px; overflow-y: auto; border: 1px solid #333; margin-bottom: 20px; font-size: 12px; font-family: serif; user-select: none; color: #aaa; }
        .nda-form { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .form-label { font-size: 10px; color: var(--accent-data); margin-bottom: 5px; font-weight: bold; }
        .nda-input { width: 100%; background: #000; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 4px; user-select: text; cursor: text; font-family: var(--font-ui); }
        /* The Hand-Written Signature Effect */
        .nda-sign { font-family: 'Dancing Script', cursive; font-size: 24px; color: var(--accent-yellow); }

        /* Email Trap */
        .email-trap { background: #000; padding: 20px; border: 1px dashed #666; margin-top: 20px; border-radius: 4px; text-align: center; }
        .resend-link { font-size: 10px; color: #666; text-decoration: underline; cursor: pointer; margin-top: 10px; display: inline-block; }

        /* MAP */
        #map { width: 100%; height: 100%; background: #ffffff; z-index: 1; }
        
        /* Cursor */
        .cursor-trail { position: fixed; pointer-events: none; z-index: 9999; font-size: 24px; opacity: 0.8; transition: 0.1s; }

    </style>
</head>
<body oncontextmenu="return false;"> <div id="loginOverlay">
    <div class="star-container">
        </div>
    <div class="login-box">
        <div class="login-title">GPTM <span style="color:var(--accent-yellow)">GATEWAY</span></div>
        <input type="text" class="login-input" id="loginEmail" placeholder="EMAIL ADDRESS" onkeypress="handleLoginKey(event)">
        <input type="password" class="login-input" id="loginPass" placeholder="PASSWORD" onkeypress="handleLoginKey(event)">
        
        <button class="enter-btn" onclick="checkLogin()">AUTHENTICATE</button>
        <div class="reg-link" onclick="handleRegister()">REGISTER NEW ACCOUNT</div>
    </div>
</div>

<header>
    <div class="brand"><i class="ph ph-globe-hemisphere-east"></i> GPTM <span>SOVEREIGN</span></div>
    <div class="ai-topbar" onclick="toggleAIChat()">
        <div class="ai-status"><div class="ai-dot" style="background:var(--accent-green)"></div> CONCIERGE</div>
        <div class="ai-status"><div class="ai-dot" style="background:var(--accent-amber)"></div> ENGINEER</div>
        <div style="width:1px; height:15px; background:#333; margin:0 10px;"></div>
        <div class="ai-msg-preview" id="aiTicker">System Online. Waiting for authorization.</div>
        <i class="ph ph-caret-down"></i>
    </div>
    <div class="header-controls">
        <div class="view-switch" id="viewSwitch">
            <button class="vs-btn" id="btnViewUser" onclick="switchView('user')">USER VIEW</button>
            <button class="vs-btn active" id="btnViewAdmin" onclick="switchView('admin')">ADMIN VIEW</button>
        </div>
        <div class="user-badge" id="headerUser">GUEST</div>
    </div>
</header>

<div id="aiDropdown"><div class="ai-body" id="chatBody"></div></div>

<div id="workflowModal">
    <div class="wf-box">
        <div class="wf-header">
            <div class="wf-title" id="wfTitle">SAMPLE DATA APPLICATION</div>
            <div class="wf-close" onclick="closeModal()">×</div>
        </div>
        <div class="wf-body" id="wfContent"></div>
        <div class="wf-footer">
            <button class="nav-btn" id="btnPrev" onclick="prevStep()">PREVIOUS</button>
            <button class="nav-btn primary" id="btnNext" onclick="nextStep()">NEXT ></button>
        </div>
    </div>
</div>

<div id="workspace">
    
    <div class="sidebar">
        <div id="sidebar-user">
            <div class="p-head">MISSION CONTROL</div>
            <div class="p-body">
                <button class="sample-btn" onclick="openWorkflow()">
                    <i class="ph ph-file-text" style="font-size:20px;"></i>
                    <div>
                        <div style="font-weight:700; font-size:12px; color:#fff;">APPLY FOR SAMPLE DATA</div>
                        <div style="font-size:9px; color:#888;">Dubai JVC (Verification Required)</div>
                    </div>
                </button>

                <div class="module">
                    <div class="mod-title">TARGET DEFINITION</div>
                    <div class="aoi-box">
                        <div style="font-size:9px; color:#888; margin-bottom:5px;">A) ADMINISTRATIVE</div>
                        <select class="sys-select" onchange="map.setView([25.05, 55.2], 10)"><option>GLOBAL</option><option>UAE (DUBAI)</option></select>
                    </div>
                    <div class="aoi-box" style="margin-bottom:0;">
                        <div style="font-size:9px; color:#888; margin-bottom:5px;">B) UPLOAD AOI</div>
                        <div class="upload-zone" onclick="alert('Upload Dialog')"><i class="ph ph-upload-simple"></i> UPLOAD .ZIP/KML</div>
                    </div>
                </div>

                <div class="module" style="border:none;">
                    <div class="mod-title">DATASET VINTAGE</div>
                    <div class="year-toggle disabled" id="row-2023" onclick="toggleLayer('2023')">
                        <div class="year-label"><span class="year-tag" style="background:var(--col-2023)"></span> 2023 ARCHIVE</div>
                        <div class="ph ph-check" style="opacity:0"></div>
                    </div>
                    <div class="year-toggle disabled" id="row-2024" onclick="toggleLayer('2024')">
                        <div class="year-label"><span class="year-tag" style="background:var(--col-2024)"></span> 2024 COLLECTION</div>
                        <div class="ph ph-check" style="opacity:0"></div>
                    </div>
                    <div class="year-toggle disabled" id="row-2025" onclick="toggleLayer('2025')">
                        <div class="year-label"><span class="year-tag" style="background:var(--col-2025)"></span> 2025 COLLECTION</div>
                        <div class="ph ph-check" style="opacity:0"></div>
                    </div>
                    <div class="year-toggle disabled" id="row-2026" onclick="toggleLayer('2026')">
                        <div class="year-label"><span class="year-tag" style="background:var(--col-2026)"></span> 2026 PREVIEW</div>
                        <div class="ph ph-check" style="opacity:0"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="sidebar-admin">
            <div class="p-head" style="color:var(--accent-yellow)">DATA MANAGEMENT</div>
            <div class="p-body">
                <div class="admin-upload-card">
                    <div class="auc-header">2023 ARCHIVE <span class="auc-status" id="st-2023">OFFLINE</span></div>
                    <div class="upload-btn-mini" onclick="adminUpload('2023')">UPLOAD VECTOR (GREY)</div>
                </div>
                <div class="admin-upload-card">
                    <div class="auc-header">2024 COLLECTION <span class="auc-status" id="st-2024">OFFLINE</span></div>
                    <div class="upload-btn-mini" onclick="adminUpload('2024')">UPLOAD VECTOR (PURPLE)</div>
                </div>
                <div class="admin-upload-card">
                    <div class="auc-header">2025 COLLECTION <span class="auc-status" id="st-2025">OFFLINE</span></div>
                    <div class="upload-btn-mini" onclick="adminUpload('2025')">UPLOAD VECTOR (BLUE)</div>
                </div>
                <div class="admin-upload-card">
                    <div class="auc-header">2026 PREVIEW <span class="auc-status" id="st-2026">OFFLINE</span></div>
                    <div class="upload-btn-mini" onclick="adminUpload('2026')">UPLOAD VECTOR (ORANGE)</div>
                </div>
            </div>
        </div>
    </div>

    <div id="map"></div>
</div>
<script>
    // --- 1. SETUP ---
    // Generate Deep Sea Stars
    const starContainer = document.querySelector('.star-container');
    for(let i=0; i<50; i++) {
        const s = document.createElement('div');
        s.className = 'star';
        s.style.left = Math.random()*100 + '%';
        s.style.top = Math.random()*100 + '%';
        s.style.width = Math.random()*3 + 'px';
        s.style.height = s.style.width;
        s.style.animationDuration = (Math.random()*5 + 5) + 's';
        s.style.animationDelay = (Math.random()*5) + 's';
        starContainer.appendChild(s);
    }

    const map = L.map('map', { zoomControl: false, minZoom: 2 }).setView([20, 0], 2);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', { maxZoom: 19 }).addTo(map);
    const layers = { '2023': L.featureGroup(), '2024': L.featureGroup(), '2025': L.featureGroup(), '2026': L.featureGroup() };

    // --- 2. LOGIN LOGIC ---
    function handleLoginKey(e) { if(e.key==='Enter') checkLogin(); }
    function checkLogin() {
        const user = document.getElementById('loginEmail').value;
        const pass = document.getElementById('loginPass').value;
        
        // ADMIN CHECK (Simple: gptm / 222)
        if (user.toLowerCase() === 'gptm' && pass === '222') {
            activateGodMode(); return;
        }
        
        // NORMAL USER CHECK (Mock)
        if(!user || !pass) { alert("Please enter Email & Password."); return; }
        
        document.getElementById('loginOverlay').style.display='none';
        document.getElementById('app').classList.add('unlocked');
        document.getElementById('headerUser').innerText = user;
        addChat('concierge', `Welcome, ${user}.`);
        startCursor('♈'); 
    }

    function handleRegister() {
        const email = document.getElementById('loginEmail').value;
        if(!email.includes('@')) { alert("Please enter a valid email to register."); return; }
        alert(`Registration successful for ${email}. Please login.`);
    }

    function activateGodMode() {
        document.getElementById('loginOverlay').style.display='none';
        document.getElementById('app').classList.add('unlocked');
        document.getElementById('headerUser').innerText = "ADMIN";
        document.getElementById('headerUser').style.color = "var(--accent-yellow)";
        document.getElementById('viewSwitch').style.display='flex';
        switchView('admin');
        startCursor('♛');
        addChat('engineer', 'Admin Console Active. All channels open.');
    }

    // --- 3. AI & UTIL ---
    function addChat(role, text) {
        document.getElementById('aiTicker').innerText = `${role.toUpperCase()}: ${text}`;
        const body = document.getElementById('chatBody');
        const row = document.createElement('div'); row.className = 'chat-row';
        row.innerHTML = `<div class="avatar ${role}">${role==='concierge'?'☺':'⚡'}</div><div class="bubble"><b>${role}:</b> ${text}</div>`;
        body.appendChild(row); body.scrollTop=9999;
    }
    function toggleAIChat() { document.getElementById('aiDropdown').style.display = document.getElementById('aiDropdown').style.display==='flex'?'none':'flex'; }
    function startCursor(char) {
        document.addEventListener('mousemove', (e) => {
            const el = document.createElement('div'); el.className = 'cursor-trail'; el.innerText = char;
            el.style.left = e.pageX+'px'; el.style.top = e.pageY+'px';
            if(document.body.classList.contains('god-mode')) el.style.color='#ffd700'; else el.style.color='#333';
            document.body.appendChild(el); setTimeout(()=>el.remove(), 200);
        });
    }
    function switchView(mode) {
        if(mode==='admin') {
            document.getElementById('sidebar-user').style.display='none';
            document.getElementById('sidebar-admin').style.display='block';
            document.getElementById('btnViewUser').classList.remove('active');
            document.getElementById('btnViewAdmin').classList.add('active');
        } else {
            document.getElementById('sidebar-user').style.display='flex';
            document.getElementById('sidebar-admin').style.display='none';
            document.getElementById('btnViewUser').classList.add('active');
            document.getElementById('btnViewAdmin').classList.remove('active');
        }
    }

    // --- 4. THE OMNI-MODAL LOGIC ---
    let step = 1;
    let emailConfirmed = false;

    function openWorkflow() {
        step = 1;
        document.getElementById('workflowModal').style.display = 'flex';
        renderStep();
    }
    function closeModal() { document.getElementById('workflowModal').style.display = 'none'; }
    
    function nextStep() {
        if(step===1 && !document.getElementById('warnCheck').checked) { alert('Please accept.'); return; }
        if(step===2) {
            const comp = document.getElementById('ndaCompany').value;
            const sign = document.getElementById('ndaSign').value;
            if(!comp || !sign) { alert('Please fill Company Name & Signature.'); return; }
            addChat('concierge', `NDA Signed by ${comp}.`);
        }
        if(step===3 && !emailConfirmed) { alert('Please confirm email receipt first.'); return; }
        step++;
        renderStep();
    }
    function prevStep() { if(step>1) step--; renderStep(); }

    function renderStep() {
        const c = document.getElementById('wfContent');
        const bNext = document.getElementById('btnNext');
        const bPrev = document.getElementById('btnPrev');
        bPrev.disabled = (step===1);
        bNext.innerText = "NEXT >";
        bNext.onclick = nextStep;

        if(step===1) {
            // STEP 1: WARNING
            c.innerHTML = `
                <div style="text-align:center; color:var(--accent-amber); font-size:40px;"><i class="ph ph-warning-octagon"></i></div>
                <h3 style="text-align:center;">PROTOCOL WARNING</h3>
                <p>1. <b>Mandatory Feedback:</b> Report required within 10 working days.<br>
                2. <b>Blacklist Policy:</b> Failure to comply results in permanent ban.<br>
                3. <b>Security:</b> Closed-loop verification active.</p>
                <div style="text-align:center; margin-top:20px;">
                    <input type="checkbox" id="warnCheck"> <label for="warnCheck">I ACCEPT THE CONSEQUENCES</label>
                </div>`;
        } else if(step===2) {
            // STEP 2: NDA
            const today = new Date().toISOString().split('T')[0];
            c.innerHTML = `
                <h3 style="text-align:center;">NON-DISCLOSURE AGREEMENT</h3>
                <div class="nda-text">
                    This Non-Disclosure Agreement (the "Agreement") is entered into by and between GPTM Sovereign (Disclosing Party) and the undersigned (Receiving Party).<br><br>
                    1. <b>Confidentiality:</b> Receiving Party agrees not to disclose Data.<br>
                    2. <b>Usage:</b> Evaluation purposes only.<br>
                    3. <b>No Download:</b> Data must remain on secure terminals.<br>
                    (Full legal text omitted for brevity...)
                </div>
                <div class="nda-form">
                    <div>
                        <div class="form-label">COMPANY NAME</div>
                        <input type="text" class="nda-input" id="ndaCompany" placeholder="Enter Company Name">
                    </div>
                    <div>
                        <div class="form-label">DATE (LOCKED)</div>
                        <input type="text" class="nda-input" value="${today}" disabled>
                    </div>
                    <div style="grid-column: span 2;">
                        <div class="form-label">DIGITAL SIGNATURE (TYPE TO SIGN)</div>
                        <input type="text" class="nda-input nda-sign" id="ndaSign" placeholder="Sign Here...">
                    </div>
                </div>`;
        } else if(step===3) {
            // STEP 3: EMAIL
            bNext.disabled = !emailConfirmed;
            c.innerHTML = `
                <h3 style="text-align:center;">VERIFICATION LOOP</h3>
                <div class="email-trap">
                    <i class="ph ph-envelope-simple" style="font-size:30px; color:#fff;"></i>
                    <div style="margin:10px 0;">Authentication link sent to: <br><b style="color:var(--accent-data)">${document.getElementById('loginEmail').value}</b></div>
                    <br>
                    <button class="action-btn primary" onclick="doConfirm()">I RECEIVED THE EMAIL</button>
                    <div class="resend-link" onclick="addChat('engineer','Route switched. Resending...')">Not received? Resend</div>
                </div>
                ${emailConfirmed ? '<div style="text-align:center; color:var(--accent-green); margin-top:10px;">✔ VERIFIED. FTP UNLOCKED.</div>' : ''}`;
        } else if(step===4) {
            // STEP 4: REPORT
            c.innerHTML = `
                <h3 style="text-align:center;">FEEDBACK REPORT</h3>
                <p style="text-align:center; color:#888;">Please upload the precision report (Appendix I) to finalize access.</p>
                <div class="upload-zone" style="margin-top:20px; padding:40px;" onclick="alert('Upload Mock')">
                    <i class="ph ph-upload-simple" style="font-size:30px;"></i><br>CLICK TO UPLOAD REPORT
                </div>`;
            bNext.innerText = "FINISH";
            bNext.onclick = () => {
                closeModal();
                addChat('engineer', 'Report accepted. You may now access AOI tools.');
            };
        }
    }

    function doConfirm() {
        emailConfirmed = true;
        addChat('concierge', 'Email Confirmed.');
        renderStep();
    }

    // --- 5. ADMIN UPLOAD ---
    function adminUpload(year) {
        const st = document.getElementById(`st-${year}`);
        st.innerText = "ONLINE"; st.className = "auc-status live";
        st.style.color = "var(--accent-green)";
        
        // Map Logic (Mock)
        const colors = {'2023':'#94a3b8', '2024':'#a855f7', '2025':'#3b82f6', '2026':'#f97316'};
        const offset = (parseInt(year)-2023)*5;
        L.rectangle([[20+offset, -20+offset], [40+offset, 20+offset]], {color: colors[year], fillOpacity:0.3}).addTo(layers[year]);
        
        // Unlock User Button
        const userBtn = document.getElementById(`row-${year}`);
        if(userBtn) userBtn.classList.remove('disabled');
        
        addChat('engineer', `${year} Vector successfully mounted.`);
    }

    function toggleLayer(year) {
        const el = document.getElementById(`row-${year}`);
        if(el.classList.contains('disabled')) return;
        el.classList.toggle('active');
        if(el.classList.contains('active')) {
            map.addLayer(layers[year]);
            el.querySelector('.ph-check').style.opacity = '1';
        } else {
            map.removeLayer(layers[year]);
            el.querySelector('.ph-check').style.opacity = '0';
        }
    }

    // Init
    addChat('concierge', 'System Online.');

</script>

</body>
</html>